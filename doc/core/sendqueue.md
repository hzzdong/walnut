---
title: 发送队列
author: zozoh
tags:
- 系统
- sendqueue
---

# 什么是发送队列

系统允许任何账号向外部第三方系统发送消息。采用的方式就是创建一个`发送队列项`。
系统后台会有处理进程处理这个发送队列项目。
第三方系统如果处理完消息，有任何返回的话，处理进程会为`发送队列项`创建一个返回对象并做关联。
同时如果你在`发送队列项`上设置了回调命令后，处理程序会开辟一个进程做调用你的命令。

也就是说，`发送队列`是系统提供的一个统一的消息发送机制。任何调用者都能通过这个机制，向任何
系统（比如，Web服务，邮件服务，甚至硬件）发送消息并处理响应。

# 怎么创建发送队列项

你在你的任何目录下，任何一个文件（**!!!注意，只能是文件，不能是目录**）加入下面的属性，
就相当于创建了一个发送队列项。

```
sq_type  : "http|imap"        # 【必】发送的类型，必选
sq_time  : 14892134910        # 【选】发送时间，默认为尽快发送
sq_callback : "obj -id ${id}" # 【选】回调命令，没有的话，则不执行回调
sq_retry : 3                  # 【选】发送失败重试次数，默认3
sg-host  : 对方主机地址
sg-port  : 主机端口号
#
# 一旦发送给第三方系统，且第三方系统有了返回，系统会在你的文件同级目录，创建
# 一个 $obj.name + ".sqreturn" 的文件对象，这个对象会有一个属性
# sq_src : "4dac.."  表示这个对象是从哪里生成的。
# 之后，系统会为源文件，增加一个属性
#
sq_return : "34cd.."  # 第三方系统返回后，给出的响应结果
```

# HTTP 请求的发送

如果想发起一个 HTTP 请求，你的文件需要有下面的属性

```
http-protocol : "http|https"   # 只能小写
http-method   : "GET|POST.."   # 大小写不敏感，默认文件有内容为POST，否则为GET
http-url      : 请求的 URL，包括 queryString
header-XXX    : 将作为 HTTP 头
```

文件的内容就是 `HTTP Body`
