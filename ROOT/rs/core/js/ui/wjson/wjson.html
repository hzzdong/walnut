<div class="ui-arena">
    <div class="ui-wedit-sky">
        <div class="ui-wedit-title">
            <i class="fa fa-file-text"></i>
            <span class="ui-tt"></span>
        </div>
        <div class="ui-wedit-actions">
            <b class="ui-btn ui-wjson-reload">
                <i class="fa fa-refresh"></i><span>{{reload}}</span>
            </b>
            <b class="ui-btn ui-wjson-save">
                <i class="fa fa-save"></i><span>{{save}}</span>
            </b>
        </div>
    </div>
    <div class="ui-wedit-main ui-wjson-main">
        <!--json格式编辑器-->
        <div class="ui-wjson-editor" v-if="showJson">
            <div class="ui-wjson-menu">
                <div class="menu-item btn" @click="toogleEditor();"><i class="fa fa-fw fa-exchange"></i></div>
                <div class="menu-item btn" @click="expandTree(json.tree)"><i class="fa fa-fw fa-expand"></i></div>
                <div class="menu-item btn" @click="collapseTree(json.tree, true)"><i class="fa fa-fw fa-compress"></i>
                </div>
                <div class="menu-item right"><input type="text" v-model="qkey"></div>
            </div>
            <div class="ui-wjson-container">
                <ul class="ui-wjson-curb">
                </ul>
                <ul class="ui-wjson-content">
                    <ui-wjson-treenode
                            depth="0"
                            ptype="object"
                            path=""
                            :tips="tips"
                            :sroot.sync="showRoot"
                            :model="json.tree"
                            :qkey.sync="qkey">
                    </ui-wjson-treenode>
                </ul>
            </div>
        </div>
        <!--源码格式编辑器-->
        <div class="ui-wjson-editor" v-else>
            <div class="ui-wjson-menu">
                <div class="menu-item btn" @click="toogleEditor();"><i class="fa fa-fw fa-exchange"></i></div>
                <div class="menu-item btn" @click="toogleCompress();"><i class="fa fa-fw"
                                                                         :class="{'fa-align-justify': compress, 'fa-align-right': !compress}"></i>
                </div>
            </div>
            <div class="ui-wjson-container">
                <ul class="ui-wjson-curb source-line">
                    <li v-for="(i, line) in source.lines" track-by="$index">{{i+1}}</li>
                </ul>
                <ul class="ui-wjson-content">
                    <li v-for="(i, line) in source.lines" track-by="$index">{{{line}}}</li>
                </ul>
            </div>
        </div>
    </div>
    <div class="ui-wedit-footer"></div>
</div>

<script type="text/x-template" id="ui-wjson-template-treenode">
    <li class="ui-wjson-treenode" :class="{'no-root' : !showTn}">
        <!--当前节点-->
        <div class="tn" v-if="showTn"
             :class="{'mkey' : matchKey, 'mval': matchVal, 'empty': isEmptyTn }">
            <template v-if="isEmptyTn">
                <span class="tn-key emptytn">{{emptyTn}}</span>
            </template>
            <template v-else>
                <!--名称 or 序号-->
                <span class="tn-key" v-if="ptype != 'array'"
                      :class="{'empty': keyEmpty, 'hasTip': hasTip}"
                      v-wjson-tn-edit="model.name" :contenteditable="true"></span>
                <span class="tn-key" v-else>{{pindex}}</span>
                <!--分隔符 or 长度-->
                <span class="tn-sp" v-if="!isFolder">:</span>
                <span class="tn-length" v-else>{{length}}</span>
                <!--内容-->
                <input type="checkbox" v-if="isBoolean" v-model="model.value"/>
                <span class="tn-val" v-if="!isFolder"
                      :class="{'boolean' : isBoolean, 'number': isNumber, 'string' : isString, 'empty': valEmpty}"
                      v-wjson-tn-edit="model.value" contenteditable="true" data-balloon="{{tipMsg}}"
                      data-balloon-pos="{{tipPos}}"></span>
                <!--错误提示-->
                <span class="tn-err" data-balloon="重复的键" data-balloon-pos="right" v-show="model.dupkey">
                    <i class="fa fa-fw fa-info-circle"></i>
                </span>
                <!--展开，折叠-->
                <div class="tn-toggle" v-if="isFolder" @click="toggle">
                    <i class="fa fa-fw" :class="{'fa-caret-down': model.open, 'fa-caret-right': !model.open}"></i>
                </div>
            </template>
            <!--动作菜单-->
            <div class="tn-menu" v-if="parseInt(depth) > 0"
                 :style="{ left: (depth * -16 + -48) + (sroot ? 0:16) + 'px' }"
                 @mousedown="showMenu"
                 @mouseleave="hideMenu"
                 :class="{'show': menuVisiable}">
                <div class="tn-menu-anchor">
                    <ul class="tn-menu-list">
                        <!--类型转换-->
                        <li v-if="!isEmptyTn">
                            <div class="tn-menu-btn" @click="expandTypes()">
                                <i class="fa fa-font act-tip btn-types"></i><span>类型</span>
                                <i class="fa fa-reorder sub-tip"></i>
                            </div>
                            <ul class="tn-menu-sublist" v-show="typeVisiable">
                                <li>
                                    <div class="tn-menu-btn" @click="convertTn('object')"
                                         :class="{'curType' : isObject}">
                                        <span>对象</span>
                                    </div>
                                </li>
                                <li>
                                    <div class="tn-menu-btn" @click="convertTn('array')"
                                         :class="{'curType' : isArray}">
                                        <span>数组</span>
                                    </div>
                                </li>
                                <li>
                                    <div class="tn-menu-btn" @click="convertTn('string')"
                                         :class="{'curType' : isString}">
                                        <span>字符串</span>
                                    </div>
                                </li>
                                <li>
                                    <div class="tn-menu-btn" @click="convertTn('number')"
                                         :class="{'curType' : isNumber}">
                                        <span>数字</span>
                                    </div>
                                </li>
                                <li>
                                    <div class="tn-menu-btn" @click="convertTn('boolean')"
                                         :class="{'curType' : isBoolean}">
                                        <span>布尔</span>
                                    </div>
                                </li>
                                <li>
                                    <div class="tn-menu-btn" @click="convertTn('null')"
                                         :class="{'curType' : isNull}">
                                        <span>空</span>
                                    </div>
                                </li>
                            </ul>
                        </li>
                        <!--空对象 空数组-->
                        <template v-if="isEmptyTn">
                            <li>
                                <div class="tn-menu-btn" @click="addItem()">
                                    <i class="fa fa-plus act-tip btn-insert"></i><span>添加</span>
                                </div>
                            </li>
                        </template>
                        <!--其他-->
                        <template v-else>
                            <li>
                                <div class="tn-menu-btn" @click="addItem()">
                                    <i class="fa fa-plus act-tip btn-insert"></i><span>添加</span>
                                </div>
                            </li>
                            <li>
                                <div class="tn-menu-btn" @click="appendItem()">
                                    <i class="fa fa-plus act-tip btn-insert"></i><span>追加</span>
                                </div>
                            </li>
                            <li>
                                <div class="tn-menu-btn" @click="copyItem()">
                                    <i class="fa fa-copy act-tip btn-clone"></i><span>复制</span>
                                </div>
                            </li>
                            <template v-if="isFolder && this.model.children.length > 0">
                                <li>
                                    <div class="tn-menu-btn" @click="cleanChildren()">
                                        <i class="fa fa-remove act-tip btn-clean"></i><span>清空</span>
                                    </div>
                                </li>
                            </template>
                            <li>
                                <div class="tn-menu-btn" @click="deleteItem()">
                                    <i class="fa fa-minus act-tip btn-delete"></i><span>删除</span>
                                </div>
                            </li>
                        </template>
                    </ul>
                </div>
                <i class="fa fa-th-list fa-fw"></i>
            </div>
        </div>
        <!--子节点-->
        <ul v-show="model.open" v-if="isFolder">
            <template v-if="model.children && model.children.length > 0">
                <ui-wjson-treenode
                        v-for="child in model.children"
                        :sroot.sync="sroot"
                        :path="cpath"
                        :tips="tips"
                        :ptype="model.type"
                        :pindex="$index"
                        :qkey.sync="qkey"
                        :depth="parseInt(depth) + 1"
                        :model.sync="child">
                </ui-wjson-treenode>
            </template>
            <template v-else>
                <ui-wjson-treenode
                        :path="cpath"
                        :sroot.sync="sroot"
                        :ptype="model.type"
                        :depth="parseInt(depth) + 1"
                        :model.sync="emptyModel">
                </ui-wjson-treenode>
            </template>
        </ul>
    </li>
</script>
